<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Café Gourmet - Compras</title>
    <link rel="stylesheet" href="css/sitecafe_p1.css">
</head>
<body>
    <header>
        <div class="banner">
            <div class="logo">
                <img src="img/logosf.png" alt="Logo Café Gourmet">
            </div>
            <h1>Aroma à máquina</h1>
        </div>
        <div class="contact-info">
            <p> Rua do Café, 123</p>
            <p> (32) 4456-9812</p>
            <a class="contatocafe" href="#" > contatoaroma@gmail.com</a>
        </div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="saches.html">Sachês</a></li>
                <li><a href="maquinas.html">Máquinas</a></li>
                <li><a href="compras.html">Compras</a></li>
            </ul>
        </nav>
    </header>
    <div class="header-line"></div>
    <main>
        <div class="content-compra">
            <div class="text">
                <h2>Finalizar Compra</h2>
                <p>Preencha seus dados e finalize sua compra.</p>
            </div>
        
            <div class="identification">
                <h3>Dados de Identificação</h3>
        
                <form class="form_identification">
                    <label for="name">Nome:</label>
                    <input type="text" id="name" name="name" required>

                    <label for="cpf">CPF:</label>
                    <input type="text" id="cpf" name="cpf" required>
                    <span id="cpf-error" class="error-message">Error</span><br><br>

                    <label for="phone">Telefone:</label>
                    <input type="tel" id="phone" name="phone" required>

                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required><br><br>

                    <label for="address">Endereço:</label>
                    <input type="text" id="address" name="address" required><br>
                </form>
            </div>
                
            <div class="products">
                <h3>Produtos</h3>
                <form class="form_products">
                    <label for="maquinas">Máquinas:</label>
                    <select id="maquinas" name="maquinas">
                        <option value="">---</option>
                        <optgroup label=" Dolce Gusto">
                            <option value="piccolo" preco="340.00">Piccolo</option>
                        </optgroup>
                        <optgroup label="Nespresso">
                            <option value="inissiac40" preco="300.00">Inissia C40</option>
                            <option value="uc50" preco="400.00">U C50</option>
                        </optgroup>
                        <optgroup label="Senseo">          
                            <option value="hd7811/96" preco="230.00">HD7811/96</option>
                        </optgroup>
                    </select><br><br>

                    <label for="saches">Sachês:</label>
                    <select id="saches" name="saches">
                        <option value="">---</option>
                        <optgroup label=" Dolce Gusto">
                            <option value="expresso" preco="24.00">Expresso</option>
                            <option value="descafeinado" preco="21.00">Descafeinado</option>
                        </optgroup>
                        <optgroup label="Nespresso">
                            <option value="livanto" preco="35.00">Livanto</option> 
                            <option value="ristretto" preco="42.00">Ristretto</option>  
                            <option value="vanilio" preco="46.00">Vanilio</option>
                        </optgroup>
                        <optgroup label="Senseo">          
                            <option value="classico" preco="14.00">Clássico</option>
                            <option value="intenso" preco="14.00">Intenso</option>
                        </optgroup>
                    </select><br><br>

                    <button type="button" name="remover">Remover Selecionados</button><br><br>
                    <textarea id="itens" name="itens" readonly></textarea><br>
                    <label for="total">Valor:</label>
                    <input type="text" id="valor" name="valor" disabled>
                </form>
            </div>
            <div class="payment">
                <h3>Forma de Pagamento</h3>
                <form class="form_payment">
                    <label for="payment-method">Método de Pagamento:</label><br><br>
                    <input type="radio" id="card" name="payment-method" value="card">
                    <label for="card">Cartão</label>
                    <input type="radio" id="cheque" name="payment-method" value="cheque">
                    <label for="cheque">Cheque</label>
                    <input type="radio" id="cash" name="payment-method" value="cash">
                    <label for="cash">Dinheiro</label><br>
                </form>
                <div>
                    <h4>Dados do Cartão</h4>
                    <label id="tipocartao" for="card-type">Tipo de Cartão:</label>
                    <form class="card-details">
                        <input type="radio" id="visa" name="card-type" value="visa">
                        <img src="img/visa.png" alt="Visa">

                        <input type="radio" id="mastercard" name="card-type" value="mastercard">
                        <img src="img/master.png" alt="MasterCard">

                        <input type="radio" id="amex" name="card-type" value="amex">
                        <label for="amex"><img src="img/amex.png" alt="American Express"></label>
                        <br><br><br>
                    </form>
                    <form class="inputcartao">

                        <label for="expiry-date">Validade:</label>
                        <input type="text" id="expiry-date" name="expiry-date" placeholder="mês" required>
                        /
                        <input type="text" id="expiry-month" name="expiry-month" placeholder="ano" ><br>
                        <label for="card-number">Número:</label>
                        <input type="text" id="card-number" name="card-number" required>
                        <span id="card-error"> Erro </span>
                    </form>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" form="form_identification">Enviar</button>
                <button type="reset" form="form_identification">Limpar</button>
            </div>
        </div>
    </main>
</body>

<!--Script para verificação do CPF-->
<script>
    document.getElementById('cpf').addEventListener('input', function () {
        const cpf = this.value;
        const errorSpan = document.getElementById('cpf-error');
        let errorMessage = '';
    
        if (!/^\d*$/.test(cpf)) {
            errorMessage = 'CPF só pode ter dígitos';
        } else {
            if (cpf.length < 11 || cpf.length> 11  ) {
                errorMessage = 'CPF deve ter 11 dígitos';
            } else if (cpf.length === 11) {
                if (!verificaDigitosVerificacao(cpf)) {
                    errorMessage = 'Verificação de dígitos inválida';
                }
            }
        }
 
        if (errorMessage) {
            errorSpan.innerHTML = errorMessage;
            errorSpan.style.display = 'block';
        } else {
            errorSpan.innerHTML = '';
            errorSpan.style.display = 'none';
        }
    });

    function verificaDigitosVerificacao(cpf) {
        const identCPF = parseInt(cpf.slice(0, 9), 10); 
    
        const primeiro_digito = calculaDV(identCPF);
        const segundo_digito = calculaDV(identCPF * 10 + primeiro_digito);
    
        return cpf[9] == primeiro_digito && cpf[10] == segundo_digito;
    }
    function calculaDV(num) {
        var resto = 0, soma = 0;
        for (let i = 2; i < 11; i++) {
            soma = soma + ((num % 10) * i);
            num = parseInt(num / 10);
        }
        resto = (soma % 11);
        return (resto > 1) ? (11 - resto) : 0;
    }
</script>

<!--Script para inclusão de itens e somatório do valor-->
<script>  
function atualizarListaEValor(selecao) {
    const itemSelecionado = selecao.value;
    const preco = selecao.selectedOptions[0].getAttribute('preco');
    const listaItens = document.getElementById('itens');
    const campoValor = document.getElementById('valor');

    if (itemSelecionado) {
        const itemTexto = selecao.selectedOptions[0].text;
        listaItens.innerHTML += itemTexto + ' - R$ ' + preco + '\n';

        const valorAtual = parseFloat(campoValor.value) || 0;
        campoValor.value= (valorAtual + parseFloat(preco)).toFixed(2);
    }

    selecao.value = '';
}

document.getElementById('maquinas').addEventListener('change', function() {
    atualizarListaEValor(this);
});

document.getElementById('saches').addEventListener('change', function() {
    atualizarListaEValor(this);
});

</script>

<!--Script para cartão de crédito-->
<script>
    document.getElementById('card-number').addEventListener('keyup', function() {
        const CartaoValor = this.value;
        const NumeroCartao = CartaoValor.replace(/\D/g, ''); 
        const visa = document.getElementById('visa');
        const mastercard = document.getElementById('mastercard');
        const amex = document.getElementById('amex');
        const cardError = document.getElementById('card-error');

        visa.checked = false;
        mastercard.checked = false;
        amex.checked = false;

        if (/\D/.test(CartaoValor) && CartaoValor !== '') {
            Erro('Somente números são permitidos');
            return; 
        }

        if (NumeroCartao.length >= 13 && NumeroCartao.length <= 16) {
            cardError.style.display = 'none';
        }

        if (NumeroCartao.length >= 1) {
            const primeiroDigito = NumeroCartao[0];

            if (primeiroDigito !== '3' && primeiroDigito !== '4' && primeiroDigito !== '5') {
                Erro('Cartão Inválido');
            } else if (primeiroDigito === '4') {
                visa.checked = true;
                TamanhoCartao(NumeroCartao.length);
            } else if (primeiroDigito === '5') {
                TamanhoCartao(NumeroCartao.length);
                if (NumeroCartao.length >= 2) {
                    const doisDigitos = parseInt(NumeroCartao.slice(0, 2));
                    if (doisDigitos >= '51' && doisDigitos <= '55') {
                        mastercard.checked = true;
                        TamanhoCartao(NumeroCartao.length);
                    } else {
                        Erro('Cartão Inválido');
                    }
                }
            } else if (primeiroDigito === '3') {
                TamanhoCartao(NumeroCartao.length);
                if (NumeroCartao.length >= 2) {
                    const doisDigitos= NumeroCartao.slice(0, 2);
                    if (doisDigitos === '34' || doisDigitos === '37') {
                        amex.checked = true;
                        TamanhoCartao(NumeroCartao.length);
                    } else {
                        Erro('Cartão Inválido');
                    }
                }
            }
        }
    });

    function Erro(mensagem) {
        const cardError = document.getElementById('card-error');
        cardError.textContent = mensagem;
        cardError.style.display = 'block' ;
    }

    function TamanhoCartao(length) {
        if (length < 13 || length > 16) {
            Erro('O cartão deve ter entre 13 e 16 dígitos');
        }
    }
</script>

<script>

</script>

</html>
               